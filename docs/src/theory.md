```@meta
CurrentModule = GeometricAlgebra
DocTestSetup = quote
	using GeometricAlgebra
end
```

```@setup ga
using GeometricAlgebra
```

# Background Theory

This is a brief overview of the mathematics of geometric algebra, using `GeometricAlgebra.jl` to explain features along the way.


## Definition

[Geometric algebra](https://en.wikipedia.org/wiki/Geometric_algebra) is what you get when vectors in a space are allowed to be multiplied freely,[^1] with the rule that a vector ``𝒖`` multiplied by itself gives its dot product, ``𝒖^2 = 𝒖⋅𝒖``.
All other features of geometric algebra follow from this relation (and from associativity ``𝒖(𝒗𝒘) = (𝒖𝒗)𝒘`` and linearity ``(λ𝒖)𝒗 = 𝒖(λ𝒗)`` with scalars ``λ``).

[^1]: “Multiplied freely” means vectors ``𝒖, 𝒗, 𝒘`` may always be combined with a product which is associative and linear. More formally, ``𝔾(V, ⋅)`` is the “freest” unital associative algebra generated by ``V`` satisfying ``𝒖^2 = 𝒖⋅𝒖`` for all ``𝒖 ∈ V``.

The definition becomes clearer after choosing a basis. In geometric algebras, orthonormal vectors ``𝒗_1, ..., 𝒗_n ∈ V`` multiply according to the rules[^2]
- ``𝒗_i^2 = 𝒗_i⋅𝒗_i``,
- ``𝒗_i𝒗_j = -𝒗_j𝒗_i`` where ``i ≠ j``.
The basis vector _norms_ ``𝒗_i⋅𝒗_i`` may be ``+1``, ``-1`` or ``0`` depending on the [metric signature](https://en.wikipedia.org/wiki/Metric_signature) of the [inner product](https://en.wikipedia.org/wiki/Inner_product_space) ``⋅`` on ``V``.

[^2]: The first rule is by the defining relation ``𝒖^2 = 𝒖⋅𝒖``, and the second rule follows from the first for orthogonal vectors.

!!! info
	A formal construction of the geometric algebra ``𝔾(V, ⋅)`` over a vector space ``V`` with inner product ``⋅`` is as the [quotient](https://en.wikipedia.org/wiki/Quotient_ring#For_algebras_over_a_ring) `` 𝔾(V, ⋅) ≅ V^⊗ \big/ I `` of the tensor algebra ``V^⊗ = ℝ ⊕ V ⊕ (V ⊗ V) ⊕ ⋯`` by the [ideal]() ``I`` generated by elements of the form ``𝒖 ⊗ 𝒖 - 𝒖⋅𝒖`` for vectors ``𝒖 ∈ V``.
	But this is usually not the most helpful definition to start with.


Geometric algebras are also called (real) [Clifford algebras](https://en.wikipedia.org/wiki/Clifford_algebra) and are denoted ``𝔾(V, ⋅)`` or ``Cl(V, q)``, where ``⋅`` has the [associated quadratic form](https://en.wikipedia.org/wiki/Bilinear_form#Derived_quadratic_form) ``q``.
Usually, we have ``V = ℝ^n`` as the base space and write ``𝔾^n`` for the resulting algebra with ``⋅`` as the standard Euclidean dot product. Write ``𝔾^{p,q}`` for ``ℝ^{p + q}`` with an inner product having ``p`` basis vectors with ``𝒗_i^2 = +1`` and ``q`` with ``𝒗_i^2 = -1``.


## Graded Structure

An ``n``-dimensional geometric algebra ``𝔾`` has a _graded structure_: as a vector space, it is the direct sum of fixed-grade subspaces
```math
𝔾(V, ⋅) = ⨁_{k=0}^n ∧^n V = ℝ ⊕ V ⊕ ∧^2 V ⊕ ⋯ ⊕ ∧^n V
```
Grade zero elements in ``∧^0V = ℝ`` are scalars; grade one elements in ``∧^1V = V`` are vectors; and grade-``k`` elements in ``∧^k V`` are **``k``-vectors** or **homogeneous multivectors**.
Elements of ``𝔾`` may contain parts of differing grade, and when they do they are called **(inhomogeneous) multivectors**.

There are no non-zero ``k``-vectors outside the range ``0 ≤ k ≤ n``, so the subspace of **pseudoscalars**, ``∧^nV``, are the highest-grade objects.

Grade | Dimension of subspace | Name
:----:|:---------:|:----
``0`` | ``1`` | scalars
``1`` | ``n`` | vectors
``2`` | ``\binom{n}{2}`` | bivectors
``3`` | ``\binom{n}{3}`` | trivectors
``⋮`` | ``⋮`` | ``⋮``
``k`` | ``\binom{n}{k}`` | ``k``-vectors
``⋮`` | ``⋮`` | ``⋮``
``n - 1`` | ``n`` | pseudovectors
``n`` | ``1`` | pseudoscalars
all | ``2^n`` | multivectors

Notice that subspaces of grade ``k`` and ``n - k`` have the same dimension.
Subspaces ``∧^kV`` and their “pseudo”-prefixed counterparts ``∧^{n - k}V`` are associated through [Hodge duality](https://en.wikipedia.org/wiki/Hodge_star_operator).

If ``A ∈ 𝔾(V, ⋅)`` is a multivector, then denote its grade ``k`` part as
```math
⟨A⟩_k ∈ ∧^kV
\quad\text{(grade projection)}
```
In code, grade projection is achieved with `grade(A, k)`:
```@repl ga
A = Multivector{4,0:4}(rand(-10:10, 2^4))
grade(A, 3)
```

## Blades and Multivectors

### Basis blades

If ``𝒗_1, ..., 𝒗_n`` are orthonormal basis vectors with ``𝒗_i⋅𝒗_i ∈ \{+1,0,-1\}`` and ``𝒗_i⋅𝒗_j = 0`` for ``i ≠ j``, then products of the form
```math
𝒗_{i_1}𝒗_{i_2}⋯𝒗_{i_k}
```
where ``i_1 < ⋯ < i_k`` are called **basis blades**. Reordering the product only introduces overall factors of ``±1``, changing the **orientation** of the blade.


Scalar multiples of basis blades are represented with the `BasisBlade{Sig,K,T}` type, which encodes indices ``i_1, ..., i_k`` as binary-ones. (See [`bits_to_indices`](@ref) and [`indices_to_bits`](@ref).)
```@repl ga
BasisBlade{4}(0b1011 => 42)
```
You can generate all basis blades (of a given grade) for an algebra with [`basis()`](@ref).
```@repl ga
basis(4, grade=2)
```

Basis blades are stored with canonically sorted indices. For example, ``𝒗_2𝒗_1`` is represented as ``-𝒗_1𝒗_2``:
```@repl ga
@basisall 2
v21
```

#### Multiplication of basis blades

Basis blades are closed under multiplication: a product of basis blades is a basis blade. (This motivates them having their own `BasisBlade` type.)


The geometric product of ``𝒗_I ≡ 𝒗_{i_1}𝒗_{i_2}⋯𝒗_{i_p}`` and ``𝒗_J ≡ 𝒗_{j_1}𝒗_{j_2}⋯𝒗_{j_q}`` can be put into canonical form it two steps:
1. Sort the basis vectors into ``𝒗_{k_1}𝒗_{k_2}⋯𝒗_{k_{p+q}}`` where ``k_1 < ⋯ < k_{p + q}``. Each transposition of adjacent vectors results in an overall factor of ``-1``.
2. Simplify adjacent repeated vectors with the relation ``𝒗^2 = 𝒗⋅𝒗``.

Mathematically, this is
```math
𝒗_I𝒗_J =
	\underbrace{\left(\sum_{k ∈ I ∩ J} 𝒗_k^2\right)}_{\text{factor from squares}}
	\underbrace{\operatorname{sign}(\operatorname{sortperm}(I ⊻ J))}_{\text{sign from swaps}}
	\; 𝒗_{I ⊻ J}
```
where ``I ∩ J`` are the shared indices and ``I ⊻ J``, the symmetric difference, are indices present in only one blade. In multi-index notation, ``𝒗_{I ⊻ J} ≡ 𝒗_{k_1}𝒗_{k_2}⋯𝒗_{k_m}`` where ``I ⊻ J = \{k_1, ..., k_m\}``.


### Blades

A product of ``k`` distinct, mutually orthogonal vectors forms a **``k``-blade**.
Equivalently, a ``k``-blade is a ``∧``-product of ``k`` many vectors.

Not all blades are representable as basis blades in the current choice of basis. For example, in ``𝔾^3`` the product ``𝒗_1(𝒗_2 + 𝒗_3)`` is a blade (since ``𝒗_1`` and ``𝒗_2 + 𝒗_3`` are orthogonal vectors), but it is a sum of two basis blades.

General blades must therefore be represented with the more general `Multivector` type.
```@repl ga
@basis 3
v1*(v2 + v3)
```

### Multivectors

A sum of ``k``-blades is a **multivector**.

!!! note
	(Pseudo)scalars and (pseudo)vectors are always blades, but not all ``k``-vectors are ``k``-blades.
	The simplest example of a homogeneous multivector which isn’t a blade requires four dimensions: the bivector ``𝒗_1𝒗_2 + 𝒗_3𝒗_4`` is not a blade since it cannot be factored as ``𝒂∧𝒃``.



## Wedge, Inner and Other Products

The geometric product is the fundamental operation in geometric algebra. Together with grade projection, various other “graded products” may be defined as various grade projections of the basic product.

To motivate this, consider a ``p``-vector ``A`` and ``q``-vector ``B``. The product contains parts of every grade between the difference ``|p - q|`` and sum ``p + q`` in steps of two:
```math
AB = ⟨AB⟩_{|p - q|} + ⟨AB⟩_{|p - q| + 2} + ⋯ + ⟨AB⟩_{p + q - 2} + ⟨AB⟩_{p + q}
```


### Scalar product

[`A ⊙ B`](@ref) or [`scalar_prod(A, B)`](@ref)


The scalar product is simply the scalar part of the geometric product:
```math
A ⊙ B ≔ ⟨AB⟩_0
```
It is also commonly denoted ``A ∗	B`` or ``⟨AB⟩``.


### Wedge product

[`A ∧ B`](@ref) or [`wedge(A, B)`](@ref)

The wedge product may be defined as the highest-grade part of the geometric product.
For example, if ``A`` and ``B`` are multivectors of grade ``p`` and ``q``, respectively, then ``A ∧ B = ⟨AB⟩_{p + q}``.
This definition can be extended linearly to general multivectors as
```math
A ∧ B ≔ \sum_{p,q} \big⟨⟨A⟩_p ⟨B⟩_q\big⟩_{p + q}
```

Between a vector ``𝒖`` and a multivector ``A``, the wedge product may be written as
```math
𝒖 ∧ A = \frac12(𝒖A + A^\star 𝒖)
```
where ``A^\star`` denotes [involution](@ref involution).
Between two vectors, the wedge product is the antisymmetric part of the product:
```math
𝒖 ∧ 𝒗 = \frac12(𝒖𝒗 - 𝒗𝒖)
```

More generally, the wedge product may be written as an antisymmetrised geometric product
```math
𝒖_1 ∧ ⋯ ∧ 𝒖_k = \frac{1}{k!}\sum_{σ ∈ S_k} \operatorname{sign}(σ) 𝒖_{σ(1)} ∧ ⋯ ∧ 𝒖_{σ(k)}
```
where the sum is over all permutations ``σ`` of the indices ``\{1, ..., k\}``.
This shows the connection to [antisymmetric tensors](https://en.wikipedia.org/wiki/Antisymmetric_tensor), but in practice it is much cheaper to compute the highest-grade part of the geometric product!


### Generalised inner product

[`A ⋅ B`](@ref) or [`inner(A, B)`](@ref)

To complement the wedge product, which is the highest-grade projection of the geometric product, we also define the generalised inner product as the lowest-grade projection.
For general multivectors, define
```math
A ⋅ B ≔ \sum_{p,q} \big⟨⟨A⟩_p ⟨B⟩_q\big⟩_{|p - q|}
```
Strictly, this should not be confused with the vector inner product, although they are equivalent on vectors.


### Left and right contractions

[`A ⨼ B`](@ref), [`A ⨽ B`](@ref) or [`lcontract(A, B)`](@ref), [`rcontract(A, B)`](@ref)


The left and right contractions are similar to the generalised inner product, except that they do not involve an absolute value, which arguably makes them more ‘uniform’.

```math
\begin{align*}
A \lcontr B &≔ \sum_{p,q} \big⟨⟨A⟩_p ⟨B⟩_q\big⟩_{q - p}
&&\text{(left contraction)}
\\
A \rcontr B &≔ \sum_{p,q} \big⟨⟨A⟩_p ⟨B⟩_q\big⟩_{p - q}
&&\text{(right contraction)}
\end{align*}
```
With a vector ``𝒖``, we have the general formulae
```math
\begin{align*}
𝒖 \lcontr A &= \frac12(𝒖A - A^\star𝒖)
,&
A \rcontr 𝒖 &= \frac12(A𝒖 - 𝒖A^\star)
\end{align*}
```

The contractions are like the two ‘sides’ of the inner product: we have ``A ⋅ B = A \lcontr B + A \rcontr B`` for general multivectors, and if ``A_p`` is a ``p``-vector and ``B_q`` a ``q``-vector then
```math
A_p ⋅ B_q = \begin{cases} A_p \lcontr B_q & p < q \\ A_p \rcontr B_q & p > q \end{cases}
```
and indeed ``A ⋅ B = A \lcontr B = A \rcontr B = A ⊙ B`` if ``p = q``.

Despite their similarities, the contractions are arguably better behaved than the inner product, since identities with the inner product tend to involve grade-based exceptions while identities with contractions tend to hold in full generally (see [Dorst2002](@cite) for discussion).

For instance, the contractions obey an associativity relation
```math
(A \lcontr B) \rcontr C = A \lcontr (B \rcontr C)
```
for all multivectors ``A, B`` and ``C``, and interact nicely with the wedge product with the identities
```math
\begin{align*}
	(A \lcontr B)I &= A ∧ (BI)
,&	I(A \rcontr B) &= (IA) ∧ B
\\	A \lcontr (B \lcontr C) &= (A ∧ B) \lcontr C
,&	(A \rcontr B) \rcontr C &= A \rcontr (B ∧ C)
\\	A \odot (B \lcontr C) &= (A ∧ B) \odot C
,&	(A \rcontr B) \odot C &= A \odot (B ∧ C)
\end{align*}
```
where ``I`` is the unit pseudoscalar
(see e.g., section 3.3 of [Wilson2022](@cite) for proofs).

## Fundamental Automorphisms

Generally, operations like complex conjugation ``\overline{AB} = \bar{A}\bar{B}`` or matrix transposition ``(AB)^⊺ = B^⊺A^⊺`` are useful because they preserve or reverse multiplication. (These are called [automorphisms](https://en.wikipedia.org/wiki/Automorphism) and [antiautomorphisms](https://en.wikipedia.org/wiki/Antihomomorphism) respect

Geometric algebras possess some important automorphisms: _reversion_ ``\tilde{A}`` and _grade involution_.

### Reversion

`~A` or [`reversion(a)`](@ref)

Reversion ``\tilde{A}`` is defined on multivectors ``A`` and ``B`` by the property
```math
\widetilde{AB} = \tilde{B}\tilde{A}
```
and by ``\tilde{𝒖} = 𝒖`` for vectors.
Computing the reversion looks like reversing the order of the geometric product:
```@repl ga
~(v1*v2*v3) == v3*v2*v1
```

Swapping orthogonal basis vectors ``𝒗_i𝒗_j ↦ 𝒗_j𝒗_i = -𝒗_i𝒗_j`` introduces an overall factor of ``-1``, and it takes ``\binom{k}{2} = \frac{k(k - 1)}{2}`` swaps to reverse ``k`` many basis vectors.
Thus, the reversion of a homogeneous ``k``-vector ``A_k`` is given by
```math
\tilde{A_k} = (-1)^{k(k - 1)/2} A_k
```
but for inhomogeneous multivectors, reversion is not simply an overall change in sign.


Grade | Reversion sign
:----:|:-----:
``k`` | ``(-1)^{k(k - 1)/2}``
``0`` | ``+1``
``1`` | ``+1``
``2`` | ``-1``
``3`` | ``-1``
``4`` | ``+1``
``5`` | ``+1``
``6`` | ``-1``
``7`` | ``-1``
``⋮`` | ``⋮``

### [Grade involution](@id involution)

[`involution(A)`](@ref)

Grade involution, sometimes denoted ``A^\star``, is the operation of reflecting space through the origin, so that vectors are sent to their negative, ``𝒖 ↦ -𝒖``. Involution is required to satisfy
```math
\mathsf{involution}(AB) = \mathsf{involution}(A)\mathsf{involution}(B)
```
which means a ``k``-blade of the form ``B = 𝒗_1 ∧ \cdots ∧ 𝒗_k`` gets sent to ``(-𝒗_1) ∧ \cdots ∧ (-𝒗_k) = (-1)^k B``.
By linearity, for any ``k``-vector ``A`` we have
```math
\mathsf{involution}(A_k) = (-1)^k A_k
```
but for inhomogeneous multivectors, involution is not simply an overall change in sign.

## Pseudoscalars and Duality

## Reflections and Rotors

## Glossary

| Term | Definition | Example |
|------|:-----------|:--------|
| _multivector_ | Any element of a geometric algebra | ``1, 𝒗_1, 1 + 𝒗_1𝒗_2``
| _``k``-vector_ | A homogeneous multivector, containing only grade-``k`` parts | ``𝒘 = 𝒗_1𝒗_2 + 𝒗_3𝒗_4`` is a ``2``-vector or _bivector_
| _vector_ | Usually refers to a ``1``-vector, even though every multivector is a “vector” in the linear algebra sense | ``𝒖 = 2𝒗_1 + 𝒗_2``
| _``k``-blade_ | A ``k``-vector which can be factored as a ``∧``-product of ``k``-many vectors | ``𝒖∧𝒗_3 = 2𝒗_1𝒗_3 + 𝒗_2𝒗_3`` is a ``2``-blade, but ``𝒘`` is not
| _basis blade_ | A ``k``-blade which is a scalar multiple of the product of orthonormal basis vectors | ``1, 2𝒗_1𝒗_3, -𝒗_1𝒗_2𝒗_3``


## References

```@bibliography
```


# Extras


## Features of geometric algebra

Geometric algebra unifies many concepts in geometry, linear algebra and physics by offering an elegant language for geometric objects and the transformations on them. In particular, it
- provides a uniform formalism for rotations in any number of dimensions;
- efficiently models Euclidean, projective, and conformal geometries;
- unifies the dot product ``⋅`` and wedge product ``∧`` from exterior calculus into the same algebra, creating an _invertible_ geometric product;
- consists of elements with concrete geometric interpretations;
- generalises the complex numbers ``ℂ``, quaternions ``ℍ``, Pauli and Dirac matrix algebras and realises them as algebras over _real_ vector spaces.

For more thorough introductions, see [Gull1993](@cite) (good for physicists).

If ``𝒗_1, ..., 𝒗_n ∈ V`` are orthonormal basis vectors, then in the geometric algebra ``𝔾(V, ⋅)``:
- Elements are generally non-commutative.
  E.g., ``𝒗_1𝒗_2 = -𝒗_2𝒗_1``.
- There are more elements than just vectors in ``V``: now there are _multivectors_ of grades ``0, ..., n``.
  E.g., ``𝒗_1𝒗_2`` is a bivector.
- Multiplication can produce multivectors of _mixed grade_.
  E.g., if ``𝒖 = 2𝒗_1 + 𝒗_2`` is a vector, then ``𝒖𝒗_2 = 1 + 2𝒗_1𝒗_2`` is a ``\{0, 2\}``-multivector with scalar and bivector parts.
- Most elements are invertible.
  E.g., if ``𝒖`` is the vector above, then ``𝒖^{-1} = \frac25 𝒗_1 + \frac15 𝒗_2`` and ``𝒖𝒖^{-1} = 1``.
- Other products, including the wedge ``∧``, can be defined in terms of the geometric product and _grade projection_.
  E.g., ``𝒖∧𝒗_2 = 2𝒗_1𝒗_2`` takes the highest-grade part of the product ``𝒖𝒗_2 = 1 + 2𝒗_1𝒗_2``.




### Example in ``ℝ^3``

To see what the definition means, we’ll look at the example ``V = ℝ^3`` with the usual Euclidean dot product: the geometric algebra of 3D space, ``𝔾(ℝ^3, ⋅)`` or ``𝔾(3)`` or ``Cl(3)``.

We may get the standard orthonormal basis ``𝒗_1, 𝒗_2, 𝒗_3 ∈ ℝ^3`` using
```@repl ga
v1, v2, v3 = basis(3)
```
From the defining relation ``𝒖^2 = 𝒖⋅𝒖``, we know how to multiply ``𝒗_1`` with itself:
```@repl ga
v1*v1
```

```@raw html
<details>
<summary>But what about <code>v1*v2</code>?</summary>
```
The relation ``𝒖^2 = 𝒖⋅𝒖`` doesn’t immediately say how to multiply two different vectors — but everything about geometric product follows from it. Notice that if we apply the relation to ``𝒖 + 𝒗`` instead of ``𝒖``, we find that
```math
\begin{align*}
	(𝒖 + 𝒗)^2 &= (𝒖 + 𝒗)⋅(𝒖 + 𝒗)
\\	𝒖^2 + 𝒖𝒗 + 𝒗𝒖 + 𝒗^2 &= 𝒖⋅𝒖 + 2𝒖⋅𝒗 + 𝒗⋅𝒗
\\	𝒖𝒗 + 𝒗𝒖 &= 2𝒖⋅𝒗
\end{align*}
```
In our case, ``𝒗_1⋅𝒗_2 = 0`` are orthogonal, so this means
```math
𝒗_1𝒗_2 = -𝒗_2𝒗_1
```
which we can check with code:
```@raw html
</details><br>
```
```@repl 3d
v1*v2
v2*v1
```
This is a new kind of object — a grade-2 bivector in 3D space:
```@repl 3d
grade(v1*v2), dimension(v1*v2)
```
In fact, there are ``2^3 = 8`` different linearly independent objects in the geometric algebra ``𝔾(3)``.
We can retrieve a basis for the full algebra with the `grade=:all` option:
```@repl 3d
basis(3, grade=:all)
```
To display a complete multiplication table for ``𝔾(3)``, you may use [`cayleytable`](@ref):
```@repl 3d
cayleytable(3)
```
