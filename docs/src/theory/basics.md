```@meta
CurrentModule = GeometricAlgebra
DocTestSetup = quote
	using GeometricAlgebra
end
```

```@setup ga
using GeometricAlgebra
```

# Geometric Algebra Fundamentals

This is a brief overview of the mathematics of geometric algebra, using `GeometricAlgebra.jl` to explain features along the way.


## Definition

[Geometric algebra](https://en.wikipedia.org/wiki/Geometric_algebra) is what you get when vectors in a space are allowed to be multiplied freely, with the rule that a vector ``ğ’–`` multiplied by itself gives its dot product, ``ğ’–^2 = ğ’–â‹…ğ’–``.
â€œFreelyâ€ means that products such as ``ğ’–ğ’—`` are left as-is â€” potentially introducing new kinds of objects â€” subject to the vector-squared relation.[^1]
All the rich features of geometric algebra follow from this relation (and from associativity ``ğ’–(ğ’—ğ’˜) = (ğ’–ğ’—)ğ’˜`` and linearity ``(Î»ğ’–)ğ’— = ğ’–(Î»ğ’—)`` with scalars ``Î»``).

[^1]: More formally, ``ğ”¾(V, â‹…)`` is the _freest_ unital associative algebra generated by ``V`` satisfying ``ğ’–^2 = ğ’–â‹…ğ’–`` for all ``ğ’– âˆˆ V``.

The meaning of this becomes clearer after choosing a basis. In geometric algebras, orthonormal vectors ``\e_1, ..., \e_n âˆˆ V`` multiply according to the rules[^2]
- ``\e_i^2 = \e_iâ‹…\e_i``,
- ``\e_i\e_j = -\e_j\e_i`` where ``i â‰  j``.
The basis vector _norms_ ``\e_iâ‹…\e_i`` may be ``+1``, ``-1`` or ``0`` depending on the [metric signature](https://en.wikipedia.org/wiki/Metric_signature) of the [inner product](https://en.wikipedia.org/wiki/Inner_product_space) ``â‹…`` on ``V``.

[^2]: The second rule is implied by the first, which is the defining relation ``ğ’–^2 = ğ’–â‹…ğ’–``.

!!! info
	A formal construction of the geometric algebra ``ğ”¾(V, â‹…)`` over a vector space ``V`` with inner product ``â‹…`` is as the [quotient](https://en.wikipedia.org/wiki/Quotient_ring#For_algebras_over_a_ring) `` ğ”¾(V, â‹…) â‰… V^âŠ— \big/ I `` of the tensor algebra ``V^âŠ— = â„ âŠ• V âŠ• (V âŠ— V) âŠ• â‹¯`` by the [ideal]() ``I`` generated by elements of the form ``ğ’– âŠ— ğ’– - ğ’–â‹…ğ’–`` for vectors ``ğ’– âˆˆ V``.
	(This is usually not the most helpful definition to start with.)


Geometric algebras are also called (real) [Clifford algebras](https://en.wikipedia.org/wiki/Clifford_algebra) and are denoted ``ğ”¾(V, â‹…)`` or ``Cl(V, q)``, where ``â‹…`` has the [associated quadratic form](https://en.wikipedia.org/wiki/Bilinear_form#Derived_quadratic_form) ``q``.
Usually, we have ``V = â„^n`` as the base space and write ``ğ”¾^n`` for the resulting algebra with ``â‹…`` as the standard Euclidean dot product. Write ``ğ”¾^{p,q}`` for ``â„^{p + q}`` with an inner product having ``p`` basis vectors with ``\e_i^2 = +1`` and ``q`` with ``\e_i^2 = -1``.


## Graded Structure

Geometric algebras have a _graded structure_. As a vector space, ``ğ”¾(V, â‹…)`` is the direct sum of fixed-grade subspaces
```math
ğ”¾(V, â‹…) = â¨_{k=0}^n âˆ§^n V = â„ âŠ• V âŠ• âˆ§^2 V âŠ• â‹¯ âŠ• âˆ§^n V
```
where ``n`` is the dimension of the base vector space, ``V``.

Grade zero elements (``âˆ§^0V = â„``) are scalars; grade one elements (``âˆ§^1V = V``) are vectors; and grade-``k`` elements (``âˆ§^k V``) are called **``k``-vectors** or **homogeneous multivectors**.
Elements of ``ğ”¾(V, â‹…)`` may consist of parts of differing grade, and when they do they are called **(inhomogeneous) multivectors**.

There are no non-zero ``k``-vectors outside the range ``0 â‰¤ k â‰¤ n``, so the subspace of ``âˆ§^nV`` contains the highest-grade objects, called **pseudoscalars**.

Grade | Dimension of subspace | Name
:----:|:---------:|:----
``0`` | ``1`` | scalars
``1`` | ``n`` | vectors
``2`` | ``\binom{n}{2}`` | bivectors
``3`` | ``\binom{n}{3}`` | trivectors
``â‹®`` | ``â‹®`` | ``â‹®``
``k`` | ``\binom{n}{k}`` | ``k``-vectors
``â‹®`` | ``â‹®`` | ``â‹®``
``n - 1`` | ``n`` | pseudovectors
``n`` | ``1`` | pseudoscalars
all | ``2^n`` | multivectors

Notice that subspaces of grade ``k`` and ``n - k`` have the same dimension.
Subspaces ``âˆ§^kV`` and their â€œpseudoâ€-prefixed counterparts ``âˆ§^{n - k}V`` are associated through [Hodge duality](https://en.wikipedia.org/wiki/Hodge_star_operator).

If ``A âˆˆ ğ”¾(V, â‹…)`` is a multivector, then denote its grade ``k`` part as
```math
âŸ¨AâŸ©_k âˆˆ âˆ§^kV
\quad\text{(grade projection)}
```
In code, grade projection is achieved with `grade(A, k)`:
```@repl ga
A = Multivector{4,0:4}(rand(-10:10, 2^4))
grade(A, 3)
```

## Blades and Multivectors

### Basis blades

If ``\e_1, ..., \e_n`` are orthonormal basis vectors with ``\e_iâ‹…\e_i âˆˆ \{+1,0,-1\}`` and ``\e_iâ‹…\e_j = 0`` for ``i â‰  j``, then products of the form
```math
\e_{i_1}\e_{i_2}â‹¯\e_{i_k}
```
where ``i_1 < â‹¯ < i_k`` are called **basis blades**. Reordering the product only introduces overall factors of ``Â±1``, changing the **orientation** of the blade.


Scalar multiples of basis blades are represented with the `BasisBlade{Sig,K,T}` type, which encodes indices ``i_1, ..., i_k`` as binary-ones. (See [`bits_to_indices`](@ref) and [`indices_to_bits`](@ref).)
```@repl ga
BasisBlade{4}(0b1011 => 42)
```
You can generate all basis blades (of a given grade) for an algebra with [`basis()`](@ref).
```@repl ga
basis(4, grade=2)
```

Basis blades are stored with canonically sorted indices. For example, ``\e_2\e_1`` is represented as ``-\e_1\e_2``:
```@repl ga
@basisall 2
v21
```

#### Multiplication of basis blades

Basis blades are closed under multiplication: a product of basis blades is a basis blade. (This motivates them having their own `BasisBlade` type.)


The geometric product of ``\e_I â‰¡ \e_{i_1}\e_{i_2}â‹¯\e_{i_p}`` and ``\e_J â‰¡ \e_{j_1}\e_{j_2}â‹¯\e_{j_q}`` can be put into canonical form it two steps:
1. Sort the basis vectors into ``\e_{k_1}\e_{k_2}â‹¯\e_{k_{p+q}}`` where ``k_1 < â‹¯ < k_{p + q}``. Each transposition of adjacent vectors results in an overall factor of ``-1``.
2. Simplify adjacent repeated vectors with the relation ``ğ’—^2 = ğ’—â‹…ğ’—``.

Mathematically, this is
```math
\e_I\e_J =
	\underbrace{\left(\sum_{k âˆˆ I âˆ© J} \e_k^2\right)}_{\text{factor from squares}}
	\underbrace{\operatorname{sign}(\operatorname{sortperm}(I âŠ» J))}_{\text{sign from swaps}}
	\; \e_{I âŠ» J}
```
where ``I âˆ© J`` are the shared indices and ``I âŠ» J``, the symmetric difference, are indices present in only one blade. In multi-index notation, ``\e_{I âŠ» J} â‰¡ \e_{k_1}\e_{k_2}â‹¯\e_{k_m}`` where ``I âŠ» J = \{k_1, ..., k_m\}``.


### Blades

A product of ``k`` distinct, mutually orthogonal vectors forms a **``k``-blade**.
Equivalently, a ``k``-blade is a ``âˆ§``-product of ``k`` many vectors.

Not all blades are representable as basis blades in the current choice of basis. For example, in ``ğ”¾^3`` the product ``\e_1(\e_2 + \e_3)`` is a blade (since ``\e_1`` and ``\e_2 + \e_3`` are orthogonal vectors), but it is a sum of two basis blades.

General blades must therefore be represented with the more general `Multivector` type.
```@repl ga
@basis 3
v1*(v2 + v3)
```

### Multivectors

A sum of ``k``-blades is a **multivector**.

!!! note
	(Pseudo)scalars and (pseudo)vectors are always blades, but not all ``k``-vectors are ``k``-blades.
	The simplest example of a homogeneous multivector which isnâ€™t a blade requires four dimensions: the bivector ``\e_1\e_2 + \e_3\e_4`` is not a blade since it cannot be factored as ``ğ’‚âˆ§ğ’ƒ``.



## Fundamental Automorphisms

Generally, operations like complex conjugation ``\overline{AB} = \bar{A}\bar{B}`` or matrix transposition ``(AB)^âŠº = B^âŠºA^âŠº`` are useful because they preserve or reverse multiplication. (These are called [automorphisms](https://en.wikipedia.org/wiki/Automorphism) and [antiautomorphisms](https://en.wikipedia.org/wiki/Antihomomorphism) respect

Geometric algebras possess some important automorphisms: _reversion_ ``\tilde{A}`` and _grade involution_.

### Reversion

`~A` or [`reversion(a)`](@ref)

Reversion ``\tilde{A}`` is defined on multivectors ``A`` and ``B`` by the property
```math
\widetilde{AB} = \tilde{B}\tilde{A}
```
and by ``\tilde{ğ’–} = ğ’–`` for vectors.
Computing the reversion looks like reversing the order of the geometric product:
```@repl ga
~(v1*v2*v3) == v3*v2*v1
```

Swapping orthogonal basis vectors ``\e_i\e_j â†¦ \e_j\e_i = -\e_i\e_j`` introduces an overall factor of ``-1``, and it takes ``\binom{k}{2} = \frac{k(k - 1)}{2}`` swaps to reverse ``k`` many basis vectors.
Thus, the reversion of a homogeneous ``k``-vector ``A_k`` is given by
```math
\tilde{A_k} = (-1)^{k(k - 1)/2} A_k
```
but for inhomogeneous multivectors, reversion is not simply an overall change in sign.


Grade | Reversion sign
:----:|:-----:
``k`` | ``(-1)^{k(k - 1)/2}``
``0`` | ``+1``
``1`` | ``+1``
``2`` | ``-1``
``3`` | ``-1``
``4`` | ``+1``
``5`` | ``+1``
``6`` | ``-1``
``7`` | ``-1``
``â‹®`` | ``â‹®``

### [Grade involution](@id involution)

[`involution(A)`](@ref)

Grade involution, sometimes denoted ``A^\star``, is the operation of reflecting space through the origin, so that vectors are sent to their negative, ``ğ’– â†¦ -ğ’–``. Involution is required to satisfy
```math
\mathsf{involution}(AB) = \mathsf{involution}(A)\mathsf{involution}(B)
```
which means a ``k``-blade of the form ``B = \e_1 âˆ§ \cdots âˆ§ \e_k`` gets sent to ``(-\e_1) âˆ§ \cdots âˆ§ (-\e_k) = (-1)^k B``.
By linearity, for any ``k``-vector ``A`` we have
```math
\mathsf{involution}(A_k) = (-1)^k A_k
```
but for inhomogeneous multivectors, involution is not simply an overall change in sign.