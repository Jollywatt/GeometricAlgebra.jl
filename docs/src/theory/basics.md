```@meta
CurrentModule = GeometricAlgebra
DocTestSetup = quote
	using GeometricAlgebra
end
```

```@setup ga
using GeometricAlgebra
```

# Geometric Algebra Fundamentals

This is a brief overview of the mathematics of geometric algebra, using `GeometricAlgebra.jl` to explain features along the way.


## Definition

[Geometric algebra](https://en.wikipedia.org/wiki/Geometric_algebra) is what you get when vectors in a space are allowed to be multiplied _freely_[^1], with the rule that a vector ``𝒖`` multiplied by itself gives its dot product, ``𝒖^2 = 𝒖⋅𝒖``.
All the rich features of geometric algebra follow from this relation, as well as the usual associativity ``𝒖(𝒗𝒘) = (𝒖𝒗)𝒘`` and linearity ``(λ𝒖)𝒗 = 𝒖(λ𝒗)`` with scalars ``λ``.

[^1]: More formally, ``𝔾(V, ⋅)`` is the _freest_ unital associative algebra generated by ``V`` satisfying ``𝒖^2 = 𝒖⋅𝒖`` for all ``𝒖 ∈ V``.

What this means becomes clearer after choosing a basis. In geometric algebras, orthonormal vectors ``𝐯_1, ..., 𝐯_n ∈ V`` multiply according to the rules[^2]
- ``𝐯_i^2 = 𝐯_i⋅𝐯_i``,
- ``𝐯_i𝐯_j = -𝐯_j𝐯_i`` where ``i ≠ j``.
The basis vector _norms_ ``𝐯_i⋅𝐯_i`` may be ``+1``, ``-1`` or ``0`` depending on the [metric signature](https://en.wikipedia.org/wiki/Metric_signature) of the [inner product](https://en.wikipedia.org/wiki/Inner_product_space) ``⋅`` on ``V``.

[^2]: The second rule is implied by the first, which is the defining relation ``𝒖^2 = 𝒖⋅𝒖``.

!!! info
	A formal construction of the geometric algebra ``𝔾(V, ⋅)`` over a vector space ``V`` with inner product ``⋅`` is as the [quotient](https://en.wikipedia.org/wiki/Quotient_ring#For_algebras_over_a_ring) `` 𝔾(V, ⋅) ≅ V^⊗ \big/ I `` of the tensor algebra ``V^⊗ = ℝ ⊕ V ⊕ (V ⊗ V) ⊕ ⋯`` by the [ideal]() ``I`` generated by elements of the form ``𝒖 ⊗ 𝒖 - 𝒖⋅𝒖`` for vectors ``𝒖 ∈ V``.
	The result is a vector space isomorphic to the exterior algebra ``∧V`` but with a product which mixes degrees.


Geometric algebras are also called (real) [Clifford algebras](https://en.wikipedia.org/wiki/Clifford_algebra) and are denoted ``𝔾(V, ⋅)`` or ``Cl(V, q)``, where ``⋅`` has the [associated quadratic form](https://en.wikipedia.org/wiki/Bilinear_form#Derived_quadratic_form) ``q``.
Usually, we have ``V = ℝ^n`` as the base space and write ``𝔾^n`` for the resulting algebra with ``⋅`` as the standard Euclidean dot product. Write ``𝔾^{p,q}`` for ``ℝ^{p + q}`` with an inner product having ``p`` basis vectors with ``𝐯_i^2 = +1`` and ``q`` with ``𝐯_i^2 = -1``.


## Graded Structure

Geometric algebras have a _graded structure_. As a vector space, ``𝔾(V, ⋅)`` is the direct sum of fixed-grade subspaces
```math
𝔾(V, ⋅) = ⨁_{k=0}^n ∧^n V = ℝ ⊕ V ⊕ ∧^2 V ⊕ ⋯ ⊕ ∧^n V
```
where ``n`` is the dimension of the base vector space, ``V``.

Grade zero elements (``∧^0V = ℝ``) are scalars; grade one elements (``∧^1V = V``) are vectors; and grade-``k`` elements (``∧^k V``) are called **``k``-vectors** or **homogeneous multivectors**.
Elements of ``𝔾(V, ⋅)`` may consist of parts of differing grade, and when they do they are called **(inhomogeneous) multivectors**.

There are no non-zero ``k``-vectors outside the range ``0 ≤ k ≤ n``, so the subspace of ``∧^nV`` contains the highest-grade objects, called **pseudoscalars**.

Grade | Dimension of subspace | Name
:----:|:---------:|:----
``0`` | ``1`` | scalars
``1`` | ``n`` | vectors
``2`` | ``\binom{n}{2}`` | bivectors
``3`` | ``\binom{n}{3}`` | trivectors
``⋮`` | ``⋮`` | ``⋮``
``k`` | ``\binom{n}{k}`` | ``k``-vectors
``⋮`` | ``⋮`` | ``⋮``
``n - 1`` | ``n`` | pseudovectors
``n`` | ``1`` | pseudoscalars
all | ``2^n`` | multivectors

Notice that subspaces of grade ``k`` and ``n - k`` have the same dimension.
Subspaces ``∧^kV`` and their “pseudo”-prefixed counterparts ``∧^{n - k}V`` are associated through [duality](dualities.md).

If ``A ∈ 𝔾(V, ⋅)`` is a multivector, then denote its grade ``k`` part as
```math
⟨A⟩_k ∈ ∧^kV
\quad\text{(grade projection)}
```
In code, grade projection is achieved with `grade(A, k)`:
```@repl ga
A = Multivector{4,0:4}(rand(-10:10, 2^4))
grade(A, 3)
```

## Blades and Multivectors

A general element in a geometric algebra is called a **multivector**, though more commonly we are interested in more specific kinds of elements.


### Basis blades

If ``𝐯_1, ..., 𝐯_n`` are orthonormal basis vectors with ``𝐯_i⋅𝐯_i ∈ \{+1,0,-1\}`` and ``𝐯_i⋅𝐯_j = 0`` for ``i ≠ j``, then products of the form
```math
𝐯_{i_1}𝐯_{i_2}⋯𝐯_{i_k}
```
where ``i_1 < ⋯ < i_k`` are called **basis blades**. Reordering the product only introduces overall factors of ``±1``, changing the **orientation** of the blade.


Scalar multiples of basis blades are represented with the `BasisBlade{Sig,K,T}` type, which encodes indices ``i_1, ..., i_k`` as binary-ones. (See [`bits_to_indices`](@ref) and [`indices_to_bits`](@ref).)
```@repl ga
BasisBlade{4}(0b1011 => 42)
```
You can generate all basis blades (of a given grade) for an algebra with [`basis()`](@ref).
```@repl ga
basis(4, grade=2)
```

Basis blades are stored with canonically sorted indices. For example, ``𝐯_2𝐯_1`` is represented as ``-𝐯_1𝐯_2``:
```@repl ga
@basisall 2
v21
```

#### Multiplication of basis blades

Basis blades are closed under multiplication: a product of basis blades is a basis blade. (This motivates them having their own `BasisBlade` type.)


The geometric product of ``𝐯_I ≡ 𝐯_{i_1}𝐯_{i_2}⋯𝐯_{i_p}`` and ``𝐯_J ≡ 𝐯_{j_1}𝐯_{j_2}⋯𝐯_{j_q}`` can be put into canonical form it two steps:
1. Sort the basis vectors into ``𝐯_{k_1}𝐯_{k_2}⋯𝐯_{k_{p+q}}`` where ``k_1 < ⋯ < k_{p + q}``. Each transposition of adjacent vectors results in an overall factor of ``-1``.
2. Simplify adjacent repeated vectors with the relation ``𝒗^2 = 𝒗⋅𝒗``.

Mathematically, this is
```math
𝐯_I𝐯_J =
	\underbrace{\left(\sum_{k ∈ I ∩ J} 𝐯_k^2\right)}_{\text{factor from squares}}
	\underbrace{\operatorname{sign}(\operatorname{sortperm}(I ⊻ J))}_{\text{sign from swaps}}
	\; 𝐯_{I ⊻ J}
```
where ``I ∩ J`` are the shared indices and ``I ⊻ J``, the symmetric difference, are indices present in only one blade. In multi-index notation, ``𝐯_{I ⊻ J} ≡ 𝐯_{k_1}𝐯_{k_2}⋯𝐯_{k_m}`` where ``I ⊻ J = \{k_1, ..., k_m\}``.


### Blades

While a basis blade is a product of orthogonal basis vectors, a **``k``-blade** is a product of ``k`` distinct, mutually orthogonal vectors.
Equivalently, a ``k``-blade is a ``∧``-product of ``k`` many vectors.

Not all blades are representable as basis blades in the current choice of basis. For example, in ``𝔾^3`` the product ``𝐯_1(𝐯_2 + 𝐯_3)`` is a blade (since ``𝐯_1`` and ``𝐯_2 + 𝐯_3`` are orthogonal vectors), but it is a sum of two basis blades.

General blades must therefore be represented with the more general `Multivector` type.
```@repl ga
@basis 3
v1*(v2 + v3)
```

### Multivectors

A sum of ``k``-blades is a **multivector**.

!!! note
	(Pseudo)scalars and (pseudo)vectors are always blades, but not all ``k``-vectors are ``k``-blades.
	The simplest example of a homogeneous multivector which isn’t a blade requires four dimensions: the bivector ``𝐯_1𝐯_2 + 𝐯_3𝐯_4`` is not a blade since it cannot be factored as ``𝒂∧𝒃``.


